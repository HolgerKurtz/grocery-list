<!DOCTYPE html>
<html>
  <head>
    <title>Update Menu</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sketchy/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center my-4">Update Menu</h1>
      <form method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group">
          {{ form.name.label }} {{ form.name(class="form-control") }}
        </div>
        <div class="form-group">
          {{ form.ingredients.label }}
          <div id="ingredients-list">
            {% for ingredient_field in form.ingredients.entries %}
            <div class="form-group ingredient">
              {{ ingredient_field(class="form-control") }}
              <button type="button" class="btn btn-danger remove-ingredient">
                Remove
              </button>
            </div>
            {% endfor %}
          </div>
          <button type="button" class="btn btn-primary" id="add-ingredient">
            Add Ingredient
          </button>
        </div>
        {{ form.submit(class="btn btn-primary") }}
      </form>
    </div>
    <script>
      $(document).ready(function () {
        $("#add-ingredient").click(function () {
          var ingredientHTML =
            '<div class="form-group ingredient">' +
            '<input type="text" class="form-control" name="ingredients-__index__-name">' +
            '<button type="button" class="btn btn-danger remove-ingredient">Remove</button>' +
            "</div>";
          var index = $("#ingredients-list .ingredient").length;
          $("#ingredients-list").append(
            ingredientHTML.replace("__index__", index)
          );
        });
        $("#ingredients-list").on("click", ".remove-ingredient", function () {
          $(this).parent(".ingredient").remove();
          $("#ingredients-list .ingredient").each(function (index, element) {
            $(element)
              .find("input")
              .attr("name", "ingredients-" + index + "-name");
          });
        });
      });
    </script>
  </body>
</html>
